<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPSTORE | Premium Cloud Catalog</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&family=Syne:wght@800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAe9T7KzOB6jaau5hcPkeicO7GYa893kcQ",
            authDomain: "ipstore-pro.firebaseapp.com",
            projectId: "ipstore-pro",
            storageBucket: "ipstore-pro.firebasestorage.app",
            messagingSenderId: "500676115572",
            appId: "1:500676115572:web:5718176fc67d26ee0e6521"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Export ke Global
        window.fb = { db, addDoc, collection, onSnapshot, deleteDoc, doc, query, orderBy };
    </script>

    <style>
        :root { --accent: #0071e3; --bg: #ffffff; --card: #f5f5f7; --text: #1d1d1f; }
        body { background: var(--bg); color: var(--text); font-family: 'Plus Jakarta Sans', sans-serif; overflow-x: hidden; }
        .navbar { background: rgba(255,255,255,0.8) !important; backdrop-filter: blur(20px); border-bottom: 1px solid #eee; }
        .hero-title { font-family: 'Syne'; font-size: clamp(3rem, 10vw, 5rem); font-weight: 800; line-height: 0.9; }
        
        /* Admin Area */
        #adminArea { display: none; background: #fff; border: 2px solid var(--accent); border-radius: 30px; padding: 35px; margin-bottom: 50px; box-shadow: 0 20px 40px rgba(0,0,0,0.05); }
        .admin-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; align-items: end; }
        
        /* Product Cards */
        .img-box { background: var(--card); height: 380px; border-radius: 35px; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; transition: 0.5s; }
        .img-box img { max-height: 80%; object-fit: contain; transition: 0.6s cubic-bezier(0.2, 1, 0.3, 1); }
        .product-card:hover .img-box img { transform: scale(1.08); }
        .btn-buy { background: var(--text); color: #fff; border-radius: 50px; padding: 14px; font-weight: 700; width: 100%; border: none; transition: 0.3s; }
        .btn-buy:hover { background: #000; transform: translateY(-3px); }
        .badge-status { position: absolute; top: 25px; right: 25px; border-radius: 50px; font-weight: 800; font-size: 0.75rem; z-index: 2; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#" style="font-family:'Syne'">IPSTORE</a>
            <button class="btn btn-outline-dark border-0 rounded-circle" onclick="login()"><i class="fas fa-key"></i></button>
        </div>
    </nav>

    <main class="container py-5">
        <div class="text-center mb-5">
            <h1 class="hero-title">Inovasi.<br>Tanpa Batas.</h1>
            <p class="mt-3 fw-bold text-muted">Authorized Cloud Experience 2026</p>
        </div>

        <div id="adminArea">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="fw-bold m-0 text-primary">Cloud Manager</h4>
                <button onclick="logout()" class="btn btn-dark btn-sm rounded-pill px-4">Logout</button>
            </div>
            <form id="pForm">
                <div class="admin-grid">
                    <div><label class="small fw-bold">Nama Produk</label><input type="text" id="n" class="form-control shadow-sm" placeholder="iPhone 15 Pro" required></div>
                    <div><label class="small fw-bold">Harga (IDR)</label><input type="number" id="h" class="form-control shadow-sm" placeholder="18000000" required></div>
                    <div><label class="small fw-bold">Link Foto</label><input type="url" id="imgUrl" class="form-control shadow-sm" placeholder="https://link-gambar.com/foto.jpg" required></div>
                    <div><label class="small fw-bold">Stok</label><select id="s" class="form-select shadow-sm"><option>Ready Stock</option><option>Sold Out</option></select></div>
                </div>
                <button type="submit" id="subBtn" class="btn btn-primary w-100 mt-4 py-3 rounded-pill fw-bold shadow">
                    Update Katalog Cloud
                </button>
            </form>
            <div class="mt-3 small text-muted text-center italic">*Cari link gambar di Google, klik kanan "Salin Alamat Gambar" lalu tempel di atas.</div>
        </div>

        <div class="row g-5" id="display">
            <div class="col-12 text-center py-5">
                <div class="spinner-border text-primary"></div>
                <p class="mt-2">Sinkronisasi Katalog...</p>
            </div>
        </div>
    </main>

    <footer class="py-5 border-top text-center mt-5">
        <h3 class="fw-bold" style="font-family:'Syne'">IPSTORE</h3>
        <p class="text-muted small">Â© 2026 Premium Retail Ecosystem. Designed for Perfection.</p>
    </footer>

    <script type="module">
        // Inisialisasi Aplikasi
        setTimeout(() => {
            const d = document;
            const disp = d.getElementById('display');

            // 1. Ambil Data Real-time (Firestore)
            const q = fb.query(fb.collection(fb.db, "items"), fb.orderBy("time", "desc"));
            fb.onSnapshot(q, (snapshot) => {
                disp.innerHTML = '';
                const isAdmin = sessionStorage.getItem('adm');
                
                if (snapshot.empty) {
                    disp.innerHTML = '<div class="col-12 text-center text-muted">Belum ada produk.</div>';
                }

                snapshot.forEach((doc) => {
                    const item = doc.data();
                    const id = doc.id;
                    const isSold = item.stok === 'Sold Out';
                    
                    disp.innerHTML += `
                        <div class="col-12 col-md-6 col-lg-4">
                            <div class="product-card">
                                <div class="img-box shadow-sm mb-4">
                                    <span class="badge badge-status px-3 py-2 ${isSold ? 'bg-danger' : 'bg-primary'}">${item.stok}</span>
                                    <img src="${item.img}" onerror="this.src='https://via.placeholder.com/400x400?text=Gambar+Rusak'">
                                </div>
                                <div class="text-center">
                                    <h4 class="fw-bold mb-2">${item.nama}</h4>
                                    <h5 class="text-primary fw-bold mb-4">Rp ${parseInt(item.harga).toLocaleString('id-ID')}</h5>
                                    ${isAdmin ? 
                                        `<button onclick="del('${id}')" class="btn btn-outline-danger w-100 rounded-pill fw-bold">Hapus Unit</button>` :
                                        `<button onclick="order('${item.nama}')" class="btn btn-buy" ${isSold ? 'disabled' : ''}>Pesan Sekarang</button>`
                                    }
                                </div>
                            </div>
                        </div>`;
                });
            });

            // 2. Simpan Data ke Database
            d.getElementById('pForm').onsubmit = async (e) => {
                e.preventDefault();
                const btn = d.getElementById('subBtn');
                btn.disabled = true; btn.innerText = "Memproses...";

                try {
                    await fb.addDoc(fb.collection(fb.db, "items"), {
                        nama: d.getElementById('n').value,
                        harga: d.getElementById('h').value,
                        img: d.getElementById('imgUrl').value,
                        stok: d.getElementById('s').value,
                        time: Date.now()
                    });

                    d.getElementById('pForm').reset();
                    Swal.fire('Berhasil!', 'Unit sudah masuk katalog.', 'success');
                } catch (e) {
                    Swal.fire('Gagal!', 'Pastikan Database Rules sudah di-set ke TRUE', 'error');
                } finally {
                    btn.disabled = false; btn.innerText = "Update Katalog Cloud";
                }
            };

            window.del = async (id) => {
                if(confirm('Hapus unit ini?')) {
                    await fb.deleteDoc(fb.doc(fb.db, "items", id));
                }
            };

        }, 1500);

        // Fungsi Global
        window.login = () => {
            Swal.fire({ title: 'Akses Admin', input: 'password', confirmButtonColor: '#0071e3' }).then(v => {
                if(v.value === 'admin123') { sessionStorage.setItem('adm', '1'); location.reload(); }
            });
        };
        window.logout = () => { sessionStorage.clear(); location.reload(); };
        window.order = (n) => { window.open(`https://wa.me/6281234567890?text=Halo IPSTORE, saya pesan ${n}`, '_blank'); };

        if(sessionStorage.getItem('adm')) d.getElementById('adminArea').style.display = 'block';
    </script>
</body>
</html>
