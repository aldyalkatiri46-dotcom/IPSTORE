<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPSTORE | Global Online Catalog</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&family=Syne:wght@800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        // === GANTI DENGAN KODE FIREBASE ANDA DI SINI ===
        const firebaseConfig = {
            apiKey: "AIzaSyAe9T7KzOB6jaau5hcPkeicO7GYa893kcQ",
            authDomain: "ipstore-pro.firebaseapp.com",
            projectId: "ipstore-pro",
            storageBucket: "ipstore-pro.firebasestorage.app",
            messagingSenderId: "500676115572",
            appId: "1:500676115572:web:5718176fc67d26ee0e6521"
        };
        // ==============================================

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        window.db = db;
        window.storage = storage;
        window.f_add = addDoc;
        window.f_coll = collection;
        window.f_snap = onSnapshot;
        window.f_del = deleteDoc;
        window.f_doc = doc;
        window.f_ref = ref;
        window.f_upload = uploadBytes;
        window.f_url = getDownloadURL;
    </script>

    <style>
        /* (Gunakan CSS yang sama seperti sebelumnya agar tampilan tetap mewah) */
        :root { --bg: #ffffff; --text: #1d1d1f; --accent: #0071e3; --card-bg: #f5f5f7; }
        body { background: var(--bg); color: var(--text); font-family: 'Plus Jakarta Sans'; transition: 0.4s; }
        .hero-title { font-family: 'Syne'; font-size: 4rem; text-align: center; margin-top: 50px; }
        .hero-subtitle { text-align: center; font-weight: 700; color: var(--text); }
        #adminArea { display: none; background: var(--card-bg); border-radius: 30px; padding: 30px; margin: 20px 0; border: 2px solid var(--accent); }
        .admin-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; align-items: end; }
        .img-box { background: var(--card-bg); height: 350px; border-radius: 30px; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }
        .img-box img { max-height: 80%; }
        .btn-buy { background: var(--text); color: #fff; width: 100%; border-radius: 50px; padding: 12px; border: none; font-weight: 700; }
        .footer-brand { font-family: 'Syne'; font-weight: 800; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg sticky-top bg-white border-bottom">
        <div class="container">
            <a class="navbar-brand" href="#">IPSTORE</a>
            <div class="d-flex gap-2">
                <button class="btn btn-light rounded-circle" onclick="loginAdmin()"><i class="fas fa-key"></i></button>
            </div>
        </div>
    </nav>

    <div class="container py-5">
        <h1 class="hero-title">Inovasi.<br>Tanpa Batas.</h1>
        <p class="hero-subtitle">Koleksi terkurasi untuk gaya hidup digital Anda.</p>

        <div id="adminArea">
            <h4 class="fw-bold mb-4">Cloud Inventory Control</h4>
            <form id="productForm" class="admin-grid">
                <div><label class="small fw-bold">Model</label><input type="text" id="pName" class="form-control" required></div>
                <div><label class="small fw-bold">Harga</label><input type="number" id="pPrice" class="form-control" required></div>
                <div><label class="small fw-bold">Stok</label><select id="pStock" class="form-select"><option>Ready Stock</option><option>Sold Out</option></select></div>
                <div><label class="small fw-bold">Kapasitas</label><select id="pStorage" class="form-select"><option>128GB</option><option>256GB</option><option>512GB</option><option>1TB</option></select></div>
                <div><label class="small fw-bold">Gambar</label><input type="file" id="pImage" class="form-control" required></div>
                <button type="submit" id="btnSubmit" class="btn btn-primary fw-bold">Upload ke Cloud</button>
            </form>
        </div>

        <div class="row g-5 mt-4" id="catalog">
            <div class="col-12 text-center py-5">
                <div class="spinner-border text-primary" role="status"></div>
                <p class="mt-2">Menghubungkan ke Server Cloud...</p>
            </div>
        </div>
    </div>

    <footer class="py-5 border-top text-center mt-5 bg-light">
        <h4 class="footer-brand">IPSTORE</h4>
        <p class="fw-bold">Â© 2026 Premium Retail Ecosystem. Designed for Perfection.</p>
    </footer>

    <script type="module">
        // Logika Admin & Render (Tunggu Firebase Siap)
        setTimeout(() => {
            const catalog = document.getElementById('catalog');
            const form = document.getElementById('productForm');

            // Render Real-time dari Firebase
            window.f_snap(window.f_coll(window.db, "products"), (snapshot) => {
                catalog.innerHTML = '';
                snapshot.forEach((doc) => {
                    const p = doc.data();
                    const id = doc.id;
                    const sold = p.stock === 'Sold Out';
                    const isAdmin = sessionStorage.getItem('isAdmin');

                    catalog.innerHTML += `
                        <div class="col-12 col-md-6 col-lg-4">
                            <div class="card border-0">
                                <div class="img-box">
                                    <span class="badge ${sold ? 'bg-danger' : 'bg-primary'} position-absolute" style="top:20px; right:20px;">${p.stock}</span>
                                    <img src="${p.imageUrl}">
                                </div>
                                <div class="p-4 text-center">
                                    <p class="small fw-bold text-muted mb-1">${p.storage}</p>
                                    <h4 class="fw-bold mb-2">${p.name}</h4>
                                    <h5 class="text-primary mb-4">Rp ${parseInt(p.price).toLocaleString('id-ID')}</h5>
                                    ${isAdmin ? 
                                        `<button onclick="deleteProduct('${id}')" class="btn btn-outline-danger w-100 rounded-pill">Hapus Unit</button>` :
                                        `<button onclick="order('${p.name}')" class="btn btn-buy" ${sold ? 'disabled' : ''}>Pesan Sekarang</button>`
                                    }
                                </div>
                            </div>
                        </div>`;
                });
            });

            // Handle Upload
            form.onsubmit = async (e) => {
                e.preventDefault();
                const btn = document.getElementById('btnSubmit');
                btn.disabled = true; btn.innerText = "Processing...";

                try {
                    const file = document.getElementById('pImage').files[0];
                    const storageRef = window.f_ref(window.storage, 'products/' + Date.now());
                    await window.f_upload(storageRef, file);
                    const url = await window.f_url(storageRef);

                    await window.f_add(window.f_coll(window.db, "products"), {
                        name: document.getElementById('pName').value,
                        price: document.getElementById('pPrice').value,
                        stock: document.getElementById('pStock').value,
                        storage: document.getElementById('pStorage').value,
                        imageUrl: url,
                        createdAt: Date.now()
                    });

                    form.reset();
                    Swal.fire('Berhasil!', 'Data tersimpan di Cloud.', 'success');
                } catch (err) {
                    Swal.fire('Error', err.message, 'error');
                }
                btn.disabled = false; btn.innerText = "Upload ke Cloud";
            };

            window.deleteProduct = async (id) => {
                if(confirm('Hapus unit ini dari server?')) {
                    await window.f_del(window.f_doc(window.db, "products", id));
                }
            };
        }, 2000);

        window.loginAdmin = () => {
            Swal.fire({ title: 'Admin', input: 'password' }).then(r => {
                if(r.value === 'admin123') {
                    sessionStorage.setItem('isAdmin', 'true');
                    document.getElementById('adminArea').style.display = 'block';
                    location.reload();
                }
            });
        };

        window.order = (name) => {
            window.open(`https://wa.me/6281234567890?text=Halo IPSTORE, saya ingin pesan ${name}`, '_blank');
        };
    </script>
</body>
</html>
